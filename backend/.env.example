# Microsoft Fabric Embedded Backend - Environment Variables
# Copy this file to .env and update with your actual values

# ============================================================================
# CORE APPLICATION SETTINGS
# ============================================================================
APP_NAME=Microsoft Fabric Embedded API
APP_VERSION=1.0.0
ENVIRONMENT=development
DEBUG=true

# Server Configuration
HOST=0.0.0.0
PORT=8000
RELOAD=true

# ============================================================================
# ENTRA ID (AZURE AD) CONFIGURATION
# ============================================================================

# Tenant Information (REQUIRED)
ENTRA_TENANT_ID=your-tenant-id-here
ENTRA_CLIENT_ID=your-backend-app-client-id-here
ENTRA_CLIENT_SECRET=your-backend-app-client-secret-here

# Authority URL (auto-generated if not provided)
# ENTRA_AUTHORITY=https://login.microsoftonline.com/your-tenant-id-here

# ============================================================================
# MICROSOFT FABRIC & POWERBI CONFIGURATION
# ============================================================================

# Fabric Workspace (REQUIRED)
FABRIC_WORKSPACE_ID=your-workspace-id-here

# Optional: Specific dataset and report IDs
FABRIC_DATASET_ID=your-dataset-id-here
FABRIC_REPORT_ID=your-report-id-here
FABRIC_CAPACITY_ID=your-capacity-id-here

# API URLs (use defaults unless custom setup)
POWERBI_API_URL=https://api.powerbi.com/v1.0/myorg
FABRIC_API_URL=https://api.fabric.microsoft.com/v1

# Token Configuration
EMBED_TOKEN_EXPIRATION_MINUTES=60
TOKEN_REFRESH_THRESHOLD_MINUTES=5

# ============================================================================
# AZURE KEY VAULT CONFIGURATION
# ============================================================================

# Key Vault URL (RECOMMENDED for production)
KEY_VAULT_URL=https://your-keyvault-name.vault.azure.net/
KEY_VAULT_NAME=your-keyvault-name

# Managed Identity (for Azure deployment)
MANAGED_IDENTITY_CLIENT_ID=your-managed-identity-client-id

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================

# JWT Configuration
JWT_SECRET_KEY=your-jwt-secret-key-change-this-in-production
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=24

# CORS Configuration (comma-separated)
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000,https://app.fabric.microsoft.com
ALLOWED_HOSTS=localhost,127.0.0.1,*.azurewebsites.net

# ============================================================================
# DATABASE CONFIGURATION (OPTIONAL)
# ============================================================================

# PostgreSQL connection string (if using database features)
# DATABASE_URL=postgresql://user:password@localhost/fabric_db
DATABASE_URL=

# Connection pool settings
DB_POOL_SIZE=5
DB_MAX_OVERFLOW=10

# ============================================================================
# CACHING CONFIGURATION
# ============================================================================

# Redis Configuration
REDIS_URL=redis://localhost:6379

# Cache TTL settings (in seconds)
CACHE_DEFAULT_TTL=3600
CACHE_TOKEN_TTL=900

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================

# Logging Level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO
LOG_FORMAT=json

# Application Insights (for Azure monitoring)
APPLICATIONINSIGHTS_CONNECTION_STRING=your-app-insights-connection-string

# ============================================================================
# RATE LIMITING
# ============================================================================

# Rate limiting configuration
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_BURST=10

# ============================================================================
# POWERBI ROLE MAPPING
# ============================================================================

# Entra ID group to PowerBI role mapping (JSON format)
# ENTRA_GROUP_MAPPINGS={"PBI-Admin":["Admin"],"PBI-RolA":["RolA"],"PBI-RolB":["RolB"]}

# ============================================================================
# MONITORING & HEALTH CHECKS
# ============================================================================

# Health check timeout in seconds
HEALTH_CHECK_TIMEOUT=30

# Enable metrics collection
METRICS_ENABLED=true

# ============================================================================
# DEVELOPMENT SETTINGS
# ============================================================================

# Auto-reload on file changes (development only)
AUTO_RELOAD=false

# Enable API documentation (disabled in production)
ENABLE_DOCS=true

# ============================================================================
# PRODUCTION OVERRIDES
# ============================================================================

# For production deployment, override these values:
# ENVIRONMENT=production
# DEBUG=false
# LOG_LEVEL=WARNING
# RELOAD=false
# AUTO_RELOAD=false
# ENABLE_DOCS=false

# ============================================================================
# AZURE APP SERVICE SPECIFIC
# ============================================================================

# These are automatically set by Azure App Service
# WEBSITES_PORT=8000
# WEBSITES_CONTAINER_START_TIME_LIMIT=1800

# ============================================================================
# OPTIONAL: ADDITIONAL SERVICES
# ============================================================================

# Email Configuration (if notifications needed)
# SMTP_SERVER=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USERNAME=your-email@domain.com
# SMTP_PASSWORD=your-email-password

# Celery Configuration (if background tasks needed)
# CELERY_BROKER_URL=redis://localhost:6379/0
# CELERY_RESULT_BACKEND=redis://localhost:6379/0

# Sentry Error Tracking
# SENTRY_DSN=your-sentry-dsn-here

# ============================================================================
# DOCKER DEVELOPMENT OVERRIDES
# ============================================================================

# When using Docker Compose, these override the defaults:
# REDIS_URL=redis://redis:6379
# DATABASE_URL=postgresql://fabric_user:fabric_password@postgres:5432/fabric_app

# ============================================================================
# NOTES FOR CONFIGURATION
# ============================================================================

# 1. REQUIRED FIELDS:
#    - ENTRA_TENANT_ID: Your Azure AD tenant ID
#    - ENTRA_CLIENT_ID: Backend app registration client ID  
#    - ENTRA_CLIENT_SECRET: Backend app registration secret (store in Key Vault for production)
#    - FABRIC_WORKSPACE_ID: Microsoft Fabric workspace containing your reports

# 2. KEY VAULT SECRETS:
#    For production, store sensitive values in Azure Key Vault:
#    - entra-client-secret: ENTRA_CLIENT_SECRET value
#    - jwt-signing-key: JWT_SECRET_KEY value
#    - database-connection-string: DATABASE_URL value (if using database)

# 3. SECURITY BEST PRACTICES:
#    - Never commit .env files to version control
#    - Use strong, unique values for JWT_SECRET_KEY
#    - Rotate secrets regularly
#    - Use HTTPS in production (handled by Azure App Service)
#    - Limit CORS origins to necessary domains only

# 4. PERFORMANCE TUNING:
#    - Adjust cache TTL values based on your use case
#    - Configure rate limits appropriate for your user base
#    - Monitor token expiration vs user experience

# 5. TROUBLESHOOTING:
#    - Set LOG_LEVEL=DEBUG for detailed logging during development
#    - Check Application Insights for production issues
#    - Verify Key Vault permissions if secrets aren't loading
#    - Ensure Entra ID app has proper API permissions

# ============================================================================